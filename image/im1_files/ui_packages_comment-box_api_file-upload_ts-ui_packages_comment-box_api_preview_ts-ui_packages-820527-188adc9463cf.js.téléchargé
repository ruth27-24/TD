"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_comment-box_api_file-upload_ts-ui_packages_comment-box_api_preview_ts-ui_packages-820527"],{42742:(e,t,r)=>{r.d(t,{fU:()=>p,jw:()=>c,zL:()=>l});var a=r(57572),i=r(96540);let l=[".svg",".gif",".jpg",".jpeg",".png",".mov",".mp4",".webm"],n=[...l,".pdf",".docx",".pptx",".xlsx",".odt",".fodt",".ods",".fods",".odp",".fodp",".odg",".fodg",".odf",".csv",".xls",".zip",".gz",".tgz",".patch",".txt",".log",".md",".json",".jsonc",".cpuprofile",".dmp"];async function o(e,t,r){let i=new FormData,{name:l,size:n,type:o}=e;return t&&i.append("repository_id",t),r&&(i.append("upload_container_type","project"),i.append("upload_container_id",r)),i.append("name",l),i.append("size",n.toString()),i.append("content_type",o),await (0,a.DI)("/upload/policies/assets",{body:i,method:"POST"})}async function s(e,t){let{upload_authenticity_token:r,upload_url:a,header:i,form:l,same_origin:n}=e,o=new FormData;for(let e in n&&o.append("authenticity_token",r),l)o.append(e,l[e]);return o.append("file",t),await fetch(a,{headers:{...i},method:"post",body:o})}async function d(e,t){let r="string"==typeof e.asset_upload_url?e.asset_upload_url:null,a="string"==typeof e.asset_upload_authenticity_token?e.asset_upload_authenticity_token:null;if(r&&a){let e=new FormData;return e.append("authenticity_token",a),await fetch(r,{method:"PUT",body:e,credentials:"same-origin",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})}return t}async function u(e,t,r){let a=await o(e,t,r);if(!a.ok)throw Error("Upload failed");let i=await a.json(),l=await s(i,e);if(!l.ok)throw Error("Upload failed");let n=await d(i,l);if(!n.ok)throw Error("Upload failed");let{href:u}=await n.json();if("string"!=typeof u)throw Error("Upload failed");return{url:u,file:e}}function c(e){return e?n:l}function p(e,t){return(0,i.useCallback)(async r=>u(r,e,t),[e,t])}},79198:(e,t,r)=>{r.d(t,{y:()=>n});var a=r(57572),i=r(96540);async function l({text:e,issue:t,repository:r,project:i,subjectType:l}){let n=new FormData;n.append("text",e),n.append("issue",t),n.append("repository",r),n.append("project",i),l&&n.append("subject_type",l);let o=await (0,a.DI)("/preview",{body:n,method:"POST"});return o.ok?Promise.resolve(await o.text()):Promise.resolve("Markdown preview unavailable")}function n({subjectId:e,subjectType:t,subjectRepoId:r}){return(0,i.useCallback)(async a=>l({text:a,issue:e?.toString()??"",repository:r?.toString()??"",project:e?.toString()??"",subjectType:function(e){switch(e){case"issue":return"Issue";case"pull_request":return"PullRequest";case"project":return"Project";default:return}}(t)}),[e,t,r])}},13274:(e,t,r)=>{r.d(t,{n:()=>eq,v:()=>eR});var a=r(74848),i=r(83476),l=r(59356),n=r(84100),o=r(80758),s=r(38621),d=r(58748),u=r(45221),c=r(75177),p=r(65481),f=r(30729),m=r(24021),g=r(96540),h=r(20053);let v=(0,g.createContext)({disabled:!1,condensed:!1,required:!1,formattingToolsRef:{current:null},uploadButtonProps:null,fileDraggedOver:!1,previewMode:!1});try{v.displayName||(v.displayName="MarkdownEditorContext")}catch{}var w=r(55847);let x=({children:e})=>(0,a.jsx)(a.Fragment,{children:e});x.displayName="MarkdownEditor.Actions";let y=(0,g.forwardRef)((e,t)=>{let{disabled:r}=(0,g.useContext)(v);return(0,a.jsx)(w.Q,{ref:t,disabled:r,...e})});y.displayName="MarkdownEditor.ActionButton";let k={flash:"ErrorMessage-module__flash--MopQ2"},b=(0,g.memo)(({message:e})=>(0,a.jsx)(p.A,{variant:"danger",full:!0,className:k.flash,children:e}));b.displayName="MarkdownEditor.ErrorMessage";let j={footer:"Footer-module__footer--ihBso",footerWrapper:"Footer-module__footerWrapper--cGLx2",footerButtonWrapper:"Footer-module__footerButtonWrapper--X7Tti",footerButton:"Footer-module__footerButton--JxULX",childrenStyling:"Footer-module__childrenStyling--ySU6Z"},_=({children:e})=>{let[t,r]=(0,m.H)(e,{footerButtons:S});return(0,a.jsxs)("footer",{className:j.footer,children:[(0,a.jsxs)("div",{className:j.footerWrapper,children:[t.footerButtons&&(0,a.jsx)("div",{className:j.footerButtonWrapper,children:t.footerButtons}),(0,a.jsx)(N,{})]}),(0,a.jsx)("div",{className:j.childrenStyling,children:r})]})},C=({children:e})=>(0,a.jsx)(_,{children:e});C.displayName="MarkdownEditor.Footer";let S=(0,g.forwardRef)((e,t)=>{let{disabled:r}=(0,g.useContext)(v);return(0,a.jsx)(w.Q,{ref:t,size:"small",disabled:r,...e})});S.displayName="MarkdownEditor.FooterButton";let N=(0,g.memo)(()=>{let{uploadButtonProps:e,fileDraggedOver:t}=(0,g.useContext)(v);return e?(0,a.jsx)(M,{fileDraggedOver:t,...e}):null});N.displayName="MarkdownEditor.DefaultFooterButtons";let M=(0,g.memo)(({fileDraggedOver:e,...t})=>{let{condensed:r,disabled:i,fileUploadProgress:l}=(0,g.useContext)(v),n=l?.[0],o=l?.[1],d=!!o,u=1===o?"Uploading your file...":`Uploading your files... (${n}/${o})`;return(0,a.jsx)(w.Q,{variant:"invisible",loadingAnnouncement:d?u:void 0,leadingVisual:s.PaperclipIcon,loading:d,size:"small",className:j.footerButton,onMouseDown:e=>{e.preventDefault()},disabled:i,...t,children:r?"Add files":e?"Drop to add files":"Paste, drop, or click to add files"})});M.displayName="MarkdownEditor.FileUploadButton";try{_.displayName||(_.displayName="CoreFooter")}catch{}let E=(0,g.forwardRef)(({forInputId:e},t)=>{(0,g.useEffect)(()=>{r.e("vendors-node_modules_github_markdown-toolbar-element_dist_index_js").then(r.bind(r,78143))},[]);let i=(0,g.useRef)(null),l=(0,g.useRef)(null),n=(0,g.useRef)(null),o=(0,g.useRef)(null),s=(0,g.useRef)(null),d=(0,g.useRef)(null),u=(0,g.useRef)(null),c=(0,g.useRef)(null),p=(0,g.useRef)(null),f=(0,g.useRef)(null),m=(0,g.useRef)(null);return(0,g.useImperativeHandle)(t,()=>({header:()=>i.current?.click(),bold:()=>l.current?.click(),italic:()=>n.current?.click(),quote:()=>o.current?.click(),code:()=>s.current?.click(),link:()=>d.current?.click(),unorderedList:()=>u.current?.click(),orderedList:()=>c.current?.click(),taskList:()=>p.current?.click(),mention:()=>f.current?.click(),reference:()=>m.current?.click()})),(0,a.jsxs)("markdown-toolbar",{for:e,style:{display:"none"},children:[(0,a.jsx)("md-header",{ref:i}),(0,a.jsx)("md-bold",{ref:l}),(0,a.jsx)("md-italic",{ref:n}),(0,a.jsx)("md-quote",{ref:o}),(0,a.jsx)("md-code",{ref:s}),(0,a.jsx)("md-link",{ref:d}),(0,a.jsx)("md-unordered-list",{ref:u}),(0,a.jsx)("md-ordered-list",{ref:c}),(0,a.jsx)("md-task-list",{ref:p}),(0,a.jsx)("md-mention",{ref:f}),(0,a.jsx)("md-ref",{ref:m})]})});E.displayName="MarkdownEditor.FormattingTools";var L=r(52464);let T=({children:e,disabled:t,required:r,visuallyHidden:i,sx:l,as:n="label",className:o,...s})=>(0,a.jsx)(L.A,{as:n,sx:{fontWeight:"bold",fontSize:1,display:"block",color:t?"fg.muted":"fg.default",cursor:t?"not-allowed":"pointer",alignSelf:"flex-start",...l},className:i?(0,h.$)("sr-only",o):o,...s,children:r?(0,a.jsxs)(c.A,{as:"span",sx:{display:"flex"},children:[(0,a.jsx)(c.A,{sx:{mr:1},children:e}),(0,a.jsx)("span",{children:"*"})]}):e});try{T.displayName||(T.displayName="InputLabel")}catch{}let I={inputLabel:"Label-module__inputLabel--NkHiQ"},D=({...e})=>{let{disabled:t,required:r}=(0,g.useContext)(v);return(0,a.jsx)(T,{as:"legend",disabled:t,required:r,className:I.inputLabel,...e})};D.displayName="MarkdownEditor.Label";let P=e=>(0,a.jsx)(D,{...e});r(90204);var R=r(62456),H=r(8338),B=r(92575),A=r(5804);let $={identifierText:"use-mention-suggestions-module__identifierText--vdUed"},F={triggerChar:"@"},O=e=>({value:e.identifier,render:t=>(0,a.jsxs)(H.l.Item,{...t,children:[e.avatarUrl&&(0,a.jsx)(H.l.LeadingVisual,{children:(0,a.jsx)(R.r,{size:16,src:e.avatarUrl})}),(0,a.jsx)("span",{className:$.identifierText,children:e.identifier})," ",(0,a.jsx)(H.l.Description,{truncate:!0,children:e.description})]})}),W=(e,t)=>{let r=Math.max((0,A.dt)(e,t.identifier),(0,A.dt)(e,t.description));return r===A.IP?r:r>0&&t.participant?A.M4:t.participant?r+A.Dx:r},V=(e,t)=>e.participant&&!t.participant?-1:t.participant&&!e.participant?1:e.identifier.localeCompare(t.identifier),U=e=>({calculateSuggestions:(0,g.useMemo)(()=>(0,B.C)(e,W,V,O),[e]),trigger:F});var z=r(44968);let K={suggestionTitle:"use-reference-suggestions-module__suggestionTitle--N45Y8"},q={triggerChar:"#",multiWord:!0},Q=e=>({value:e.id,render:t=>(0,a.jsxs)(H.l.Item,{...t,children:[e.iconHtml&&(0,a.jsx)(H.l.LeadingVisual,{children:(0,a.jsx)(z.yx,{unverifiedHTML:e.iconHtml})}),(0,a.jsx)("span",{className:K.suggestionTitle,children:(0,a.jsx)(z.yx,{unverifiedHTML:e.titleHtml})})," ",(0,a.jsxs)(H.l.Description,{truncate:!0,children:["#",e.id]})]})}),G=(e,t)=>(0,A.dt)(e,`${t.id} ${t.titleText}`),X=(e,t)=>0,Z=e=>({calculateSuggestions:(0,g.useMemo)(()=>{let t=(0,B.C)(e,G,X,Q);return async e=>/^\d+\s/.test(e)?[]:t(e)},[e]),trigger:q});var J=r(70255),Y=r(83876),ee=r(64515),et=r(51856),er=r(44358),ea=r(12800);let ei=e=>{let[t,r]=(0,g.useState)(null),[a,i]=(0,g.useState)(null),l=(0,g.useMemo)(()=>e.map(({trigger:e})=>e),[e]),n=(0,g.useRef)(null);return(0,g.useEffect)(()=>{if(!a){r(null);return}(async function(){for(let{trigger:t,suggestionsCalculator:i}of(n.current=a,r("loading"),e))if(a.trigger.triggerChar===t.triggerChar){r(await i(a.query));break}})()},[a,e]),{triggers:l,suggestions:t,setSuggestionEvent:i,onHideSuggestions:()=>{i(null),r(null)},active:!!a}},el={textArea:"MarkdownInput-module__textArea--QjIwG",fullHeight:"MarkdownInput-module__fullHeight--GQ5pQ",monospace:"MarkdownInput-module__monospace--hhBf3",displayNone:"MarkdownInput-module__displayNone--PnY5h",isDraggedOver:"MarkdownInput-module__isDraggedOver--Ual6r"},en=[],eo=(0,g.forwardRef)(({value:e,onChange:t,onInput:r,disabled:i,placeholder:l,id:n,maxLength:o,onKeyDown:s,fullHeight:d,isDraggedOver:u,emojiSuggestions:c,emojiTone:p,mentionSuggestions:f,referenceSuggestions:m,labelledBy:v,minHeightLines:w,maxHeightLines:x,visible:y,monospace:k,pasteUrlsAsPlainText:b,className:j,..._},C)=>{let S=(0,g.useMemo)(()=>({tone:p}),[p]),{trigger:N,calculateSuggestions:M}=(0,Y.x)(c??en,S),{trigger:E,calculateSuggestions:L}=U(f??en),{trigger:T,calculateSuggestions:I}=Z(m??en),{triggers:D,suggestions:P,setSuggestionEvent:R,onHideSuggestions:H}=ei((0,g.useMemo)(()=>[{trigger:N,suggestionsCalculator:M},{trigger:E,suggestionsCalculator:L},{trigger:T,suggestionsCalculator:I}],[M,L,I,N,E,T])),B=(0,g.useRef)(null);(0,ee.T)(C,B),(0,g.useEffect)(()=>{let e=B.current&&(0,er.B1)(B.current,{defaultPlainTextPaste:{urlLinks:b}});return e?.unsubscribe},[b]);let A=(0,ea.S)({disabled:d||!y,maxHeightLines:x,minHeightLines:w,elementRef:B,value:e});return(0,g.useEffect)(()=>{B.current&&(B.current.value=e)}),(0,a.jsx)(J.a,{triggers:D,suggestions:P,onShowSuggestions:R,onHideSuggestions:H,firstOptionSelectionMode:"selected",style:{flex:"auto"},tabInsertsSuggestions:!0,children:(0,a.jsx)(et.Ay,{id:n,ref:B,placeholder:l,maxLength:o,onKeyDown:s,disabled:i,"aria-label":v?void 0:"Markdown value","aria-labelledby":v,onChange:t,onInput:r,value:e,className:(0,h.$)(j,el.textArea,!y&&el.displayNone,d&&el.fullHeight,k&&el.monospace,u&&el.isDraggedOver),rows:w,style:A,..._})})});eo.displayName="MarkdownInput";var es=r(19920),ed=r(10871),eu=r(87330);let ec={iconButton:"ToolbarButton-module__iconButton--fTMrr"},ep=(0,g.forwardRef)((e,t)=>{let{disabled:r,condensed:i}=(0,g.useContext)(v);return(0,a.jsx)(eu.K,{ref:t,size:i?"small":"medium",variant:"invisible",disabled:r,onMouseDown:e=>e.preventDefault(),...e,className:ec.iconButton})});ep.displayName="MarkdownEditor.ToolbarButton";var ef=r(47584);let em=(0,g.createContext)(null),eg=()=>{let e=(0,g.useContext)(em);(0,g.useImperativeHandle)(e?.ref,()=>({openMenu:()=>{r(!0)}}));let[t,r]=(0,g.useState)(!1);(0,g.useEffect)(()=>{l(""),t&&e?.onOpen()},[e,t]);let[i,l]=(0,g.useState)(""),n=e?.savedReplies.filter(({name:e})=>e.toLowerCase().includes(i.toLowerCase())).map((e,t)=>({text:e.name,description:e.content,descriptionVariant:"block",trailingVisual:t<9?`Ctrl + ${t+1}`:void 0,sx:{"& [class*=BaseVisualContainer]:first-child":{display:"none"},"& [class*=DescriptionContainer]":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"}}})),o=t=>{r(!1);let a=e?.savedReplies.find(({name:e})=>e===t?.text);a&&e?.onSelect(a)};return n?(0,a.jsx)(es.X,{renderAnchor:e=>(0,a.jsx)(ep,{...e,icon:s.ReplyIcon,"aria-label":"Saved replies","aria-labelledby":void 0}),open:t,onOpenChange:r,items:n,filterValue:i,onFilterChange:l,placeholderText:"Search saved replies",selected:void 0,onSelectedChange:e=>{o(Array.isArray(e)?e[0]:e)},overlayProps:{width:"small",maxHeight:"small",anchorSide:"outside-right",onKeyDown:e=>{let t=parseInt(e.key,10);n&&e.ctrlKey&&!Number.isNaN(t)&&t>=1&&t<=9&&(e.stopPropagation(),e.preventDefault(),o(n[t-1]))}},footer:(0,a.jsx)(ed.z,{size:"small",href:`${ef.fV.origin}/settings/replies`,block:!0,children:"Create new"})}):(0,a.jsx)(a.Fragment,{})};try{em.displayName||(em.displayName="SavedRepliesContext")}catch{}try{eg.displayName||(eg.displayName="SavedRepliesButton")}catch{}var eh=r(69676),ev=r(82678);let ew={divider:"Toolbar-module__divider--uW6mE",toolbar:"Toolbar-module__toolbar--CkIKP"},ex=()=>(0,a.jsx)("div",{className:ew.divider}),ey=(0,g.memo)(()=>{let{condensed:e,formattingToolsRef:t}=(0,g.useContext)(v);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(ep,{onClick:()=>t.current?.header(),icon:s.HeadingIcon,"aria-label":"Heading"}),(0,a.jsx)(ep,{onClick:()=>t.current?.bold(),icon:s.BoldIcon,"aria-label":"Bold"}),(0,a.jsx)(ep,{onClick:()=>t.current?.italic(),icon:s.ItalicIcon,"aria-label":"Italic"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ex,{}),(0,a.jsx)(ep,{onClick:()=>t.current?.quote(),icon:s.QuoteIcon,"aria-label":"Quote"}),(0,a.jsx)(ep,{onClick:()=>t.current?.code(),icon:s.CodeIcon,"aria-label":"Code"}),(0,a.jsx)(ep,{onClick:()=>t.current?.link(),icon:s.LinkIcon,"aria-label":"Link"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ex,{}),(0,a.jsx)(ep,{onClick:()=>t.current?.unorderedList(),icon:s.ListUnorderedIcon,"aria-label":"Unordered list"}),(0,a.jsx)(ep,{onClick:()=>t.current?.orderedList(),icon:s.ListOrderedIcon,"aria-label":"Numbered list"}),(0,a.jsx)(ep,{onClick:()=>t.current?.taskList(),icon:s.TasklistIcon,"aria-label":"Task list"})]}),!e&&(0,a.jsxs)("div",{children:[(0,a.jsx)(ex,{}),(0,a.jsx)(ep,{onClick:()=>t.current?.mention(),icon:s.MentionIcon,"aria-label":"Mention"}),(0,a.jsx)(ep,{onClick:()=>t.current?.reference(),icon:s.CrossReferenceIcon,"aria-label":"Reference"})]}),(0,a.jsx)(eg,{})]})});ey.displayName="MarkdownEditor.DefaultToolbarButtons";let ek=({children:e})=>{let t=(0,g.useRef)(null);return(0,ev.G)({containerRef:t,focusInStrategy:"closest",bindKeys:eh.z0.ArrowHorizontal|eh.z0.HomeAndEnd,focusOutBehavior:"wrap"}),(0,a.jsx)("div",{ref:t,"aria-label":"Formatting tools",role:"toolbar",className:ew.toolbar,children:e})},eb=({children:e})=>(0,a.jsx)(ek,{children:e});eb.displayName="MarkdownEditor.Toolbar";try{ex.displayName||(ex.displayName="Divider")}catch{}try{ek.displayName||(ek.displayName="CoreToolbar")}catch{}var ej=r(60499);let e_={viewSwitch:"ViewSwitch-module__viewSwitch--fmIde",tabNavLink:"ViewSwitch-module__tabNavLink--AZkCL",editColor:"ViewSwitch-module__editColor--UxQhv",previewColor:"ViewSwitch-module__previewColor--aXo83"},eC=({selectedView:e,onViewSelect:t,onLoadPreview:r,disabled:i})=>{let l="preview"===e?{onClick:()=>t?.("edit")}:{onClick:()=>{r(),t?.("preview")},onMouseOver:()=>r(),onFocus:()=>r()};return(0,a.jsx)("div",{className:e_.viewSwitch,children:(0,a.jsxs)(ej.A,{"aria-label":"View mode",children:[(0,a.jsx)(ej.A.Link,{...l,as:"button",selected:"edit"===e,disabled:i,className:(0,h.$)(e_.tabNavLink,"edit"===e?e_.editColor:e_.previewColor),children:"Write"}),(0,a.jsx)(ej.A.Link,{...l,as:"button",selected:"preview"===e,disabled:i,className:(0,h.$)(e_.tabNavLink,"preview"===e?e_.editColor:e_.previewColor),children:"Preview"})]})})};try{eC.displayName||(eC.displayName="ViewSwitch")}catch{}let eS=/^([^/]+)\/([^;]+)/,eN=e=>{if(e.startsWith("."))return t=>t.name.toLowerCase().endsWith(e.toLowerCase());{let t=eS.exec(e);if(null===t)return()=>!1;let[,r,a]=t;return e=>{let[,t,i]=eS.exec(e.type)??[];return r?.toLowerCase()===t?.toLowerCase()&&("*"===a||a?.toLowerCase()===i?.toLowerCase())}}};function eM(e){let t=(0,g.useMemo)(()=>e.acceptedFileTypes?.map(eN),[e.acceptedFileTypes]),r=(0,g.useCallback)(e=>t?.some(t=>t(e))??!0,[t]);return(0,g.useCallback)(function(t){if(0===t.length)return!1;if(e.multi){let a=[],i=[];for(let e of t)r(e)?a.push(e):i.push(e);e.onSelect(a,i)}else{let a=t[0];a&&r(a)?e.onSelect(a,void 0):e.onSelect(void 0,a)}return!0},[r,e.multi,e.onSelect])}let eE=e=>Array.from(e.dataTransfer.items).some(({kind:e})=>"file"===e);var eL=r(32020),eT=r(42445);let eI=e=>(0,eL.nf)(`Uploading "${e.name}"...`),eD=(e,t,r)=>t?e.type.startsWith("video/")?t:e.type.startsWith("image/")?(0,eL.TG)(r||{width:0,height:0,ppi:1},t,"Image"):(0,eL.iQ)(e.name,t):(0,eL.nf)(`Failed to upload "${e.name}"`),eP=()=>{},eR=({emitChange:e,value:t,inputRef:r,disabled:a,onUploadFile:i,acceptedFileTypes:l})=>{let[o,s]=(0,g.useState)(void 0),d=(0,g.useRef)(!1);(0,g.useEffect)(()=>{if(o){d.current=!1;let e=setTimeout(()=>d.current=!0,1e3);return()=>clearTimeout(e)}},[o]),(0,g.useEffect)(()=>{d.current&&s(void 0)},[t]);let u=(0,n.U)(e=>{let t=new Set(e.map(({name:e})=>{let t=e.split(".");return t.length>1?`.${t.at(-1)}`:""}).filter(e=>""!==e));t.size>0&&s(`File type${t.size>1?"s":""} not allowed: ${[...t].join(", ")}`)}),[c,p]=(0,g.useState)(void 0),f=(0,n.U)(()=>p(void 0)),m=(0,g.useCallback)(t=>{if(!r?.current)return;let a=function(e,t){if(0===t||"\n"===e[t-1]&&(1===t||"\n"===e[t-2]))return"";let r=e.lastIndexOf("\n",t-1);return/\S/.test(e.substring(r,t))?"\n\n":"\n"}(r.current.value,r.current.selectionStart),i=function(e,t){if(e.length===t||"\n"===e[t]&&(t===e.length-1||"\n"===e[t+1]))return"";let r=e.indexOf("\n",t);return/\S/.test(e.substring(t,r))?"\n\n":"\n"}(r.current.value,r.current.selectionEnd);e(`${a}${t.map(eI).join("\n")}${i}`)},[r,e]),h=(t,a,i)=>{if(!r?.current)return;let l=eI(t),n=r.current.value.indexOf(l);-1!==n&&e(eD(t,a,i),[n,n+l.length])},v=(0,n.U)(({file:e,url:t},r)=>{p(e=>e&&[e[0]+1,e[1]]),h(e,t,r)}),w=(0,g.useCallback)(e=>e.map(async e=>{let t={url:null,file:e},r=null;try{t=await i?.(e)??{file:e,url:null}}catch{t={file:e,url:null}}if(t.url)try{r=await (0,eL.pF)(e)}catch{r={width:0,height:0,ppi:1},(0,eT.N7)("Failed to get image size from file",{message:"Failed to get image size from file",reactAppName:"markdown-editor"})}v(t,r)}),[i,v]),x=function(e){let t=function(e){let t=eM(e),{multi:r,acceptedFileTypes:a}=e,i=(0,g.useRef)(null),l=(0,g.useCallback)(function(){this.files&&t(this.files)},[t]);(0,g.useEffect)(function(){let e=document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("multiple",r?"true":"false"),a&&e.setAttribute("accept",a.join(", ")),e.style.display="none",e.addEventListener("change",l),document.body.appendChild(e),i.current=e,()=>{i.current=null,e.removeEventListener("change",l),e.parentNode?.removeChild(e)}},[r,a,l]);let n=(0,g.useCallback)(()=>i.current?.click(),[]);return(0,g.useMemo)(()=>({onClick:n}),[n])}(e),r=function(e){let t=eM(e);return(0,g.useMemo)(()=>({onPaste:e=>{t(e.clipboardData.files)&&e.preventDefault()}}),[t])}(e),[a,i]=function(e){let t=eM(e),[r,a]=(0,g.useState)(!1),i=(0,g.useCallback)(()=>a(!1),[]),l=(0,g.useCallback)(e=>{eE(e)&&(a(!0),e.stopPropagation(),e.preventDefault())},[]),n=(0,g.useCallback)(e=>{eE(e)&&(e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy")},[]),o=(0,g.useCallback)(e=>{t(e.dataTransfer.files)&&(e.preventDefault(),a(!1))},[t]);return[r,(0,g.useMemo)(()=>({onDragEnter:l,onDragOver:n,onDragLeave:i,onDrop:o}),[o,n,i,l])]}(e);return(0,g.useMemo)(()=>({clickTargetProps:t,pasteTargetProps:r,dropTargetProps:i,isDraggedOver:a}),[t,i,a,r])}({acceptedFileTypes:l,multi:!0,onSelect:(0,g.useCallback)(async(e,t)=>{e.length>0&&(p([1,e.length]),m(e),await Promise.all(w(e)),f()),u(t)},[u,m,w,f])});return a&&(x={clickTargetProps:{onClick:eP},dropTargetProps:{onDragEnter:eP,onDragLeave:eP,onDrop:eP,onDragOver:eP},pasteTargetProps:{onPaste:eP},isDraggedOver:!1}),i?{...x,errorMessage:o,uploadProgress:c}:null},eH=/^(?:\t| ? ?)(.*)/,eB=e=>eH.exec(e)?.[1]??"",eA=e=>`  ${e}`,e$=({emitChange:e})=>({onKeyDown:(0,g.useCallback)(t=>{let r=t.currentTarget;if(t.defaultPrevented||"Tab"!==t.key||r.selectionEnd-r.selectionStart==0)return;t.preventDefault();let[a,i]=(0,eL.ty)(r),l=r.value.slice(a,i).split(/\r?\n/).map(e=>t.shiftKey?eB(e):eA(e)).join("\n");e(l,[a,i],[a,a+l.length])},[e])});var eF=r(27278),eO=r(75632),eW=r(73218);let eV={container:"MarkdownEditor-module__container--LVNU1",inputWrapper:"MarkdownEditor-module__inputWrapper--MtV0d",fieldSet:"MarkdownEditor-module__fieldSet--VAeuT",previewHeader:"MarkdownEditor-module__previewHeader--kOTcb",fullHeight:"MarkdownEditor-module__fullHeight--loH82",hidden:"MarkdownEditor-module__hidden--_X5vc",disabled:"MarkdownEditor-module__disabled--idNQD",previewWrapper:"MarkdownEditor-module__previewWrapper--UHhTL",header:"MarkdownEditor-module__header--i0pok",viewSwitchWrapper:"MarkdownEditor-module__viewSwitchWrapper--ezg8E",viewSwitchBorder:"MarkdownEditor-module__viewSwitchBorder--zeiDB",previewViewerWrapper:"MarkdownEditor-module__previewViewerWrapper--ZCTeH",flash:"MarkdownEditor-module__flash--bC3Co"},eU=Symbol(),ez=[],eK=(0,g.forwardRef)(({value:e,onChange:t,onInputFocus:r,disabled:w=!1,placeholder:y,maxLength:k,"aria-describedby":j,labelledBy:S,fullHeight:N,onRenderPreview:M,sx:L,onPrimaryAction:T,viewMode:I,onChangeViewMode:D,minHeightLines:R=5,maxHeightLines:H=35,emojiSuggestions:B,emojiTone:A,mentionSuggestions:$,referenceSuggestions:F,onUploadFile:O,acceptedFileTypes:W,monospace:V=!1,required:U=!1,name:z,children:K,savedReplies:q,pasteUrlsAsPlainText:Q=!1,errorMessage:G,teamHovercardsEnabled:X=!1,onSavedRepliesOpen:Z=eW.l},J)=>{let[Y,ee]=(0,m.H)(K,{toolbar:eb,actions:x,label:P,footer:C}),[et,er]=(0,g.useState)("edit"),[ea,ei]=void 0===I?[et,er]:[I,D],[el,en]=(0,g.useState)(null),es=(0,n.U)(en),ed=(0,g.useRef)(!0);(0,g.useEffect)(()=>{ed.current=!0},[e]);let eu=async()=>{ed.current&&(ed.current=!1,es(null),es(await M(e)))},ec=(0,eO.G7)("mardown_editor_use_on_input");(0,g.useEffect)(()=>{"preview"===ea&&ed.current&&eu()});let[ep,ef]=(0,g.useState)(1),eg=()=>{t(""),ef(e=>e+1)},eh=(0,g.useRef)(null);(0,g.useImperativeHandle)(J,()=>({focus:e=>eh.current?.focus(e),scrollIntoView:e=>eE.current?.scrollIntoView(e),reset:()=>eg(),[eU]:void 0}));let ev=(0,g.useRef)(0);eh.current&&eh.current.offsetHeight&&(ev.current=eh.current.offsetHeight);let ew=(0,g.useCallback)(e=>{t(e.target.value)},[t]),ex=(0,o.H)({inputRef:eh,fallbackEventHandler:ew}),ej=eR({emitChange:ex,value:e,inputRef:eh,disabled:w,onUploadFile:O,acceptedFileTypes:W}),e_=ej?.uploadProgress!==void 0,eS=(0,eF.KI)({emitChange:ex}),eN=e$({emitChange:ex}),eM=(0,g.useRef)(null),eE=(0,g.useRef)(null),[eT,eI]=(0,g.useState)(!1),eD=(0,g.useCallback)(()=>eI(null!==eE.current&&eE.current.clientWidth<675),[]);(0,d.w)(eD,eE),(0,u.A)(()=>{let e=eE.current;if(!e)return;let t=e.parentElement,r=eE.current.nextSibling;t?.removeChild(e),t?.insertBefore(e,r)},[eT]);let eP=(0,g.useId)(),eH=`${eP}-description`,eB=(0,g.useRef)(null),eA=(0,g.useMemo)(()=>q?{savedReplies:q,onSelect:e=>{requestAnimationFrame(()=>ex(e.content))},onOpen:Z,ref:eB}:null,[ex,Z,q]),eK=(0,l._)(e=>{let t=eM.current;if(!w){if(e.ctrlKey&&"."===e.key)eB.current?.openMenu(),e.preventDefault(),e.stopPropagation();else if((0,eL.VL)(e)){if("Enter"!==e.key||e_){if("b"===e.key)t?.bold();else if("i"===e.key)t?.italic();else if(e.shiftKey&&"."===e.key)t?.quote();else if("e"===e.key)t?.code();else if("k"===e.key)t?.link();else if("8"===e.key)t?.unorderedList();else if(e.shiftKey&&"7"===e.key)t?.orderedList();else if(e.shiftKey&&["l","L"].includes(e.key))t?.taskList();else{if(!(e.shiftKey&&["p","P"].includes(e.key)))return;ei?.("preview")}}else T?.();e.preventDefault(),e.stopPropagation()}else eS.onKeyDown(e),eN.onKeyDown(e)}});(0,g.useEffect)(()=>{if("preview"===ea){ez.push(eP);let e=e=>{!e.defaultPrevented&&ez.at(-1)===eP&&(0,eL.VL)(e)&&e.shiftKey&&"p"===e.key&&(ei?.("edit"),setTimeout(()=>eh.current?.focus()),e.preventDefault())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e),ez=ez.filter(e=>e!==eP)}}},[ea,ei,eP]);let eq=(0,g.useMemo)(()=>({disabled:w,formattingToolsRef:eM,condensed:eT,required:U,fileDraggedOver:ej?.isDraggedOver??!1,fileUploadProgress:ej?.uploadProgress,uploadButtonProps:ej?.clickTargetProps??null,errorMessage:ej?.errorMessage,previewMode:"preview"===ea}),[w,eT,U,ej?.isDraggedOver,ej?.uploadProgress,ej?.clickTargetProps,ej?.errorMessage,ea]);return(0,a.jsx)(v.Provider,{value:eq,children:(0,a.jsxs)("fieldset",{"aria-disabled":w,className:(0,h.$)(eV.fieldSet,N&&eV.fullHeight),children:[(0,a.jsx)(E,{ref:eM,forInputId:eP}),(0,a.jsx)("div",{className:eV.hidden,children:ee}),Y.label,(0,a.jsxs)("div",{ref:eE,className:eV.container,children:[(0,a.jsxs)(c.A,{className:(0,h.$)("edit"===ea?eV.inputWrapper:eV.previewWrapper,w&&eV.disabled,N&&eV.fullHeight),sx:L,children:[(0,a.jsxs)("span",{className:"sr-only",id:eH,"aria-live":"polite",children:["Markdown input:","preview"===ea?" preview mode selected.":" edit mode selected."]}),(0,a.jsxs)("header",{className:eV.header,children:[(0,a.jsxs)("div",{className:eV.viewSwitchWrapper,children:[(0,a.jsx)(eC,{selectedView:ea,onViewSelect:ei,disabled:ej?.uploadProgress!==void 0,onLoadPreview:eu}),(0,a.jsx)("div",{className:eV.viewSwitchBorder})]}),(0,a.jsx)(em.Provider,{value:eA,children:"edit"===ea&&(Y.toolbar??(0,a.jsx)(ek,{children:(0,a.jsx)(ey,{})}))})]}),(0,a.jsx)(eo,{value:e,onChange:ec?void 0:ew,onInput:ec?ew:void 0,onFocus:r,emojiSuggestions:B,emojiTone:A,mentionSuggestions:$,referenceSuggestions:F,disabled:w,placeholder:y,labelledBy:S,"aria-describedby":j?`${eH} ${j}`:eH,id:eP,maxLength:k,ref:eh,fullHeight:N,isDraggedOver:ej?.isDraggedOver??!1,minHeightLines:R,maxHeightLines:H,visible:"edit"===ea,monospace:V,required:U,name:z,pasteUrlsAsPlainText:Q,...eK,...ej?.pasteTargetProps,...ej?.dropTargetProps},ep),(0,a.jsx)("div",{role:"alert",children:"edit"===ea&&ej?.errorMessage&&(0,a.jsx)(b,{message:ej.errorMessage})}),"preview"===ea&&(0,a.jsxs)("div",{"aria-live":"polite",tabIndex:-1,className:(0,h.$)(eV.previewViewerWrapper,N&&eV.fullHeight),style:{minHeight:ev.current},children:[(0,a.jsx)("h2",{className:eV.previewHeader,children:"Rendered Markdown Preview"}),(0,a.jsx)(i.G,{verifiedHTML:el||"Nothing to preview",loading:null===el,teamHovercardsEnabled:X,openLinksInNewTab:!0})]})]}),G&&(0,a.jsxs)(p.A,{variant:"danger",className:eV.flash,children:[(0,a.jsx)(f.A,{icon:s.StopIcon,className:"mr-2"}),G]}),Y.footer??(0,a.jsx)(_,{children:(0,g.isValidElement)(Y.actions)&&Y.actions.props.children})]})]})})});eK.displayName="MarkdownEditor";let eq=Object.assign(eK,{Label:P,Toolbar:eb,ToolbarButton:ep,DefaultToolbarButtons:ey,Footer:C,FooterButton:S,Actions:x,ActionButton:y,MarkdownEditorContext:v})},92575:(e,t,r)=>{r.d(t,{C:()=>i});var a=r(5804);let i=(e,t,r,i,l)=>async n=>{if("loading"===e)return"loading";let o=Array.isArray(e)?e:await e(),s=n?o.map(e=>[t(n,e),e]).filter(([e])=>e>a.IP).sort(([e,t],[a,i])=>a===e?-r(i,t):a-e).slice(0,5).map(([,e])=>e):o.slice(0,5);return l&&s.sort(r),s.map(i)}},12800:(e,t,r)=>{r.d(t,{S:()=>l});var a=r(38568),i=r(96540);let l=({disabled:e,minHeightLines:t,maxHeightLines:r,elementRef:l,value:n})=>{let[o,s]=(0,i.useState)(void 0),[d,u]=(0,i.useState)(void 0),[c,p]=(0,i.useState)(void 0),f=(0,i.useCallback)(()=>{if(e)return;let a=l.current;if(!a)return;let i=getComputedStyle(a);s(`calc(${a.scrollHeight}px - ${i.paddingTop} - ${i.paddingBottom})`);let n="normal"===i.lineHeight?`1.2 * ${i.fontSize}`:i.lineHeight;void 0!==t&&u(`calc(${t} * ${n})`),void 0!==r&&p(`calc(${r} * ${n})`)},[t,r,n,l,e]);return(0,a.N)(f,[f]),(0,i.useEffect)(f,[]),{height:o,minHeight:d,maxHeight:c,boxSizing:"content-box"}}},84100:(e,t,r)=>{r.d(t,{U:()=>n,g:()=>l});var a=r(38568),i=r(96540);let l=Symbol("callbackCancelledResult"),n=(e,t=!1)=>{let r=(0,i.useRef)(e);(0,a.N)(()=>{r.current=e},[e]);let n=(0,i.useRef)(!1);return(0,i.useEffect)(()=>(n.current=!0,()=>{t||(n.current=!1)}),[t]),(0,i.useCallback)((...e)=>n.current?r.current(...e):l,[])}},83876:(e,t,r)=>{r.d(t,{x:()=>v});var a=r(74848),i=r(8338),l=r(96540),n=r(92575),o=r(5804),s=r(90204);function d(e){return"character"in e}let u=new Set(["+1","thumbsup","-1"]),c={triggerChar:":",keepTriggerCharOnCommit:!1},p=(e,t)=>void 0!==t?(0,a.jsx)("g-emoji",{alias:e.name,tone:t,"fallback-src":e.url,children:e.character}):e.character,f=(e,t)=>d(e)?void 0!==t?(0,s.R3)(e.character,t):e.character:`:${e.name}:`,m=e=>t=>({value:f(t,e),key:t.name,render:r=>(0,a.jsxs)(i.l.Item,{...r,children:[(0,a.jsx)(i.l.LeadingVisual,{children:d(t)?p(t,e):(0,a.jsx)("img",{src:t.url,alt:`${t.name} emoji`,height:"16",width:"16"})}),t.name]})}),g=(e,t)=>{let r=t.name.toLowerCase(),a=e.toLowerCase(),i=0;return r.includes(a)&&(i+=5,r.startsWith(a)&&(i+=5)),0===i?o.IP:i},h=(e,t)=>{let r=e.name.toLowerCase(),a=t.name.toLowerCase();return u.has(r)&&!u.has(a)?-1:u.has(a)&&!u.has(r)?1:0},v=(e,t)=>({calculateSuggestions:(0,l.useMemo)(()=>(0,n.C)(e,g,h,m(t?.tone),!0),[e,t?.tone]),trigger:c});try{u.displayName||(u.displayName="PRIORITIZED_EMOJIS")}catch{}}}]);
//# sourceMappingURL=ui_packages_comment-box_api_file-upload_ts-ui_packages_comment-box_api_preview_ts-ui_packages-820527-12b5d642dc63.js.map